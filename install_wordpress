# Install mariadb
echo "[Install WordPress] installing and starting mariadb
yum -y install mariadb mariadb-server
systemctl start mariadb
systemctl enable mariadb


# Install epel-release
echo "[Install WordPress] Installing epel-release"
sudo yum -y install epel-release

# Install Nginx
echo "[Install WordPress] Installing nginx"
yum -y install nginx
systemctl restart nginx

# Allow nginx through firewall
echo "[Install WordPress] setting firewall roles"
sudo firewall-cmd --permanent --zone=public --add-service=http
sudo firewall-cmd --permanent --zone=public --add-service=https
sudo firewall-cmd --permanent --zone=public --add-port=80/tcp
sudo firewall-cmd --permanent --zone=public --add-port=80/udp
sudo firewall-cmd --reload
systemctl enable nginx

# Install php-fpm
echo "[Install WordPress] installing and configuring php-fpm"
yum -y install php-fpm php-mysql php-cli
cp php.ini /etc/php.ini
cp www.conf /etc/php-fpm.d/
cp virtual.conf /etc/nginx/conf.d/

#Create dir
mkdir /usr/share/nginx/html/dtbui.local

# Restarting services
echo "[Install WordPress] Restarting services"
systemctl restart nginx
systemctl restart php-fpm
systemctl enable php-fpm

# Install phpmyadmin
echo "[Install WordPress]  installing phpmyadmin and configuring files"
yum -y install phpmyadmin php
cp phpMyAdmin.conf /etc/nginx/conf.d/

# Restarting services
systemctl restart nginx
systemctl restart php-fpm
cp wordpress.conf /etc/nginx/conf.d/
mkdir /usr/share/nginx/wordpress.dtbui.local
mkdir /usr/share/nginx/wordpress.dtbui.local/logs
systemctl restart nginx
systemctl restart php-fpm

#Creating mysql database/useraccount
echo "[Install WordPress] Creating mysql database & useraccount"
mysql -u root -p
CREATE DATABASE wordpress;
CREATE USER 'dtbui'@'localhost' IDENTIFIED BY 'testing123!';
GRANT ALL PRIVILEGES ON wordpress.* TO 'dtbui'@'localhost';
exit

# Install WordPress
echo "[Install WordPress] Installing and extracting WordPress"
wget http://wordpress.org/latest.tar.gz
tar -zxvf latest.tar.gz
cp wp-config.php /usr/share/nginx/wordpress.dtbui.local/
chown -R nginx:nginx /usr/share/nginx/wordpress.dtbui.local/

#Done
echo "[Install WordPress] Done!"
